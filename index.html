<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Agent_X Masterconsole · Ebene 0 (9 Module) · v1.0</title>
<style>
  :root{
    --bg:#0b0e16; --panel:#0d111c; --card:#101724; --edge:#1b2740;
    --ink:#eaf4ff; --muted:#a9bed6;
    --glow-cyan: 0 0 20px rgba(47,183,255,.35), 0 0 40px rgba(47,183,255,.25);
    --glow-orange: 0 0 20px rgba(255,159,26,.35), 0 0 40px rgba(255,159,26,.25);
    --glow-lime: 0 0 20px rgba(139,220,101,.35), 0 0 40px rgba(139,220,101,.25);
    --cyan:#2fb7ff; --orange:#ff9f1a; --lime:#8bdc65;
    --bar-bg:#0b1322; --bar-ink:#0e192b;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  header{background:#140d0b;border-bottom:1px solid #3a231c;color:#ffd3b0}
  .hwrap{display:flex;align-items:center;justify-content:space-between;padding:10px 16px}
  .title{font-weight:700;letter-spacing:.3px}
  .meta{opacity:.9}
  .grid{padding:16px;display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
  .card{
    background:linear-gradient(180deg,#0f1522,#0b121d 45%,#0b1018);
    border:1px solid var(--edge);
    border-radius:16px; padding:14px; min-height:200px; position:relative;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
  }
  .card.cyan   { box-shadow: var(--glow-cyan); }
  .card.orange { box-shadow: var(--glow-orange); }
  .card.lime   { box-shadow: var(--glow-lime); }

  .card h3{margin:0 0 6px 0; font-size:1.1rem; letter-spacing:.2px}
  .sub{color:var(--muted); font-size:.92rem; margin-bottom:8px}
  .bars{display:flex;flex-direction:column;gap:8px}
  .bar{height:10px;border-radius:999px;background:var(--bar-bg);position:relative;overflow:hidden}
  .bar>span{display:block;height:100%}
  .b-orange{background:var(--orange)} .b-cyan{background:var(--cyan)} .b-lime{background:var(--lime)}
  .row{display:flex;align-items:center;justify-content:space-between; gap:10px}
  .kpi{font-size:.95rem; color:#d4e6ff}
  .btn{margin-top:12px;background:#1a2234;border:1px solid #263653;color:var(--ink);padding:8px 12px;border-radius:10px;cursor:pointer}
  .btn:hover{filter:brightness(1.08)}
  footer{padding:10px 16px;color:#9ab1c9;font-size:.9rem}
  @media (max-width:1180px){ .grid{grid-template-columns:repeat(2,1fr)} }
  @media (max-width:760px){ .grid{grid-template-columns:1fr} }
</style>
</head>
<body>
<header>
  <div class="hwrap">
    <div class="title">🧠 Agent_X Masterconsole v1.0 — Ebene 0 (9 Hauptmodule)</div>
    <div class="meta" id="meta">Snapshot: — · Quelle: AgentX_Ablage</div>
  </div>
</header>

<main class="grid" id="grid">
  <!-- Kacheln werden dynamisch gerendert -->
</main>

<footer>
  Tipp: Klick auf eine Kachel öffnet Ebene 1 (gefilterte Ansicht). „Recycle Bin“ ist bewusst ausgeblendet.
</footer>

<script>
  // === KONFIG (mit deiner URL) ===
  const DATA_ENDPOINT = 'https://script.google.com/macros/s/AKfycbwyn7YNLnHkiak3b-3Euqae1_gZZEfiN2Y7S3Qk_T8_CWk_PUnYLQxh155Bx7r6Eh6FWg/exec';
  const API_URL = DATA_ENDPOINT + (DATA_ENDPOINT.includes('?') ? '&' : '?') + 'mode=tree';
  const LEVEL1_URL = './level1.html';

  const COLOR_BY_KEY = {
    "AgentX_Deck Commander Central":"cyan",
    "AgentX_Lounge":"cyan",
    "Agentx_Bibliothek_of_Alexandria":"lime",
    "AgentX_Economics":"orange",
    "AgentX_Health":"lime",
    "Agentx_Laboratory":"orange",
    "Agentx_Crew":"cyan",
    "AgentX_Projects / Ideas":"orange",
    "Agentx_Systems & Security":"cyan"
  };

  async function load(){
    try{
      const r = await fetch(API_URL, {cache:'no-store', mode:'cors'});
      const data = await r.json();
      render(data);
    }catch(err){
      document.getElementById('meta').textContent = 'Snapshot: — · Fehler beim Laden';
      console.error(err);
    }
  }

  function fmtBytes(n){
    if(!n) return '0 B';
    const u=['B','KB','MB','GB','TB']; let i=0;
    while(n>=1024 && i<u.length-1){ n/=1024; i++; }
    return n.toFixed(n>=10?0:1)+' '+u[i];
  }
  function percentFromCounts(fileCount){
    const base = Math.max(20, Math.min(95, Math.round((fileCount % 87) + 8)));
    return base;
  }

  function render(data){
    const grid = document.getElementById('grid');
    grid.innerHTML = '';

    const snap = data.snapshot ? new Date(data.snapshot).toLocaleString('de-DE',{timeZone:'Europe/Madrid'}) : '—';
    document.getElementById('meta').textContent = `Snapshot: ${snap} · Quelle: ${data.root?.name || 'AgentX_Ablage'} · Ordner: ${data.children?.length ?? 0}`;

    (data.children || []).forEach(mod=>{
      const color = COLOR_BY_KEY[mod.name] || 'cyan';
      const pOverall = percentFromCounts(mod.fileCount||0);
      const pInput   = Math.min(100, Math.round(pOverall * 0.92));
      const pSync    = Math.min(100, Math.round(pOverall * 0.84));
      const pStatus  = Math.min(100, Math.round(pOverall * 0.76));
      const last = mod.lastUpdated ? new Date(mod.lastUpdated).toLocaleString('de-DE',{timeZone:'Europe/Madrid'}) : '—';

      grid.insertAdjacentHTML('beforeend', `
        <section class="card ${color}">
          <h3>${mod.title || mod.name}</h3>
          <div class="sub">Detailansicht & Status — ${mod.title || mod.name}</div>

          <div class="row"><div class="kpi">📁 Dateien</div><div class="kpi">${mod.fileCount ?? 0}</div></div>
          <div class="row"><div class="kpi">💾 Größe</div><div class="kpi">${fmtBytes(mod.sizeBytes||0)}</div></div>
          <div class="row"><div class="kpi">🕒 Zuletzt</div><div class="kpi">${last}</div></div>

          <div class="bars" style="margin-top:10px">
            <div class="bar"><span class="b-orange" style="width:${pOverall}%"></span></div>
            <div class="bar"><span class="b-lime"   style="width:${pInput}%"></span></div>
            <div class="bar"><span class="b-cyan   " style="width:${pSync}%"></span></div>
            <div class="bar"><span class="b-orange" style="width:${pStatus}%"></span></div>
          </div>

          <button class="btn" onclick="openLevel1('${encodeURIComponent(mod.name)}')">Öffnen</button>
        </section>
      `);
    });
  }

  function openLevel1(modName){
    const url = `${LEVEL1_URL}?mod=${modName}`;
    window.location.href = url;
  }

  load();
  setInterval(load, 120000);
</script>
</body>
</html>
